<app-account-top-header></app-account-top-header>
<app-account-navbar></app-account-navbar>

<div class="profile-area">
    <div class="container-fluid">
        <!-- Page Header -->
        <div class="profile-header">
            <div class="header-content">
                <h1><i class="bx bx-user-circle"></i> My Profile</h1>
                <p>Manage your personal information, address, and family members</p>
            </div>
            <div class="header-actions" *ngIf="hasChanges">
                <button class="btn-cancel" (click)="cancelChanges()">
                    <i class="bx bx-x"></i> Cancel
                </button>
                <button class="btn-save" (click)="saveProfile()" [disabled]="saving || !isFormValid()">
                    <i class="bx" [ngClass]="saving ? 'bx-loader-alt bx-spin' : 'bx-save'"></i>
                    {{ saving ? 'Saving...' : 'Save Changes' }}
                </button>
            </div>
        </div>

        <!-- Success Message -->
        <div class="alert-message success" *ngIf="saveSuccess">
            <i class="bx bx-check-circle"></i>
            <span>Your profile has been updated successfully!</span>
        </div>

        <!-- Error Message -->
        <div class="alert-message error" *ngIf="saveError">
            <i class="bx bx-error-circle"></i>
            <span>There was an error saving your profile. Please try again.</span>
        </div>

        <div class="profile-content">
            <div class="row">
                <!-- Main Form Column -->
                <div class="col-lg-8">
                    <!-- Personal Information -->
                    <div class="profile-card">
                        <div class="card-header">
                            <span class="header-icon"><i class="bx bx-user"></i></span>
                            <h3>Personal Information</h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>First Name <span class="required">*</span></label>
                                        <input
                                            type="text"
                                            class="form-input"
                                            [(ngModel)]="profileData.firstName"
                                            (ngModelChange)="onFieldChange()"
                                            placeholder="Enter your first name">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Last Name <span class="required">*</span></label>
                                        <input
                                            type="text"
                                            class="form-input"
                                            [(ngModel)]="profileData.lastName"
                                            (ngModelChange)="onFieldChange()"
                                            placeholder="Enter your last name">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Email Address <span class="required">*</span></label>
                                        <input
                                            type="email"
                                            class="form-input"
                                            [(ngModel)]="profileData.email"
                                            (ngModelChange)="onFieldChange()"
                                            placeholder="your.email@example.com">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Phone Number</label>
                                        <input
                                            type="tel"
                                            class="form-input"
                                            [(ngModel)]="profileData.phone"
                                            (ngModelChange)="onFieldChange()"
                                            placeholder="(555) 123-4567">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Date of Birth</label>
                                        <input
                                            type="date"
                                            class="form-input"
                                            [(ngModel)]="profileData.dateOfBirth"
                                            (ngModelChange)="onFieldChange()">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Address Information -->
                    <div class="profile-card">
                        <div class="card-header">
                            <span class="header-icon"><i class="bx bx-map"></i></span>
                            <h3>Address</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label>Street Address</label>
                                <input
                                    type="text"
                                    class="form-input"
                                    [(ngModel)]="profileData.address"
                                    (ngModelChange)="onFieldChange()"
                                    placeholder="123 Main Street">
                            </div>
                            <div class="row">
                                <div class="col-md-5">
                                    <div class="form-group">
                                        <label>City</label>
                                        <input
                                            type="text"
                                            class="form-input"
                                            [(ngModel)]="profileData.city"
                                            (ngModelChange)="onFieldChange()"
                                            placeholder="City">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>State</label>
                                        <select
                                            class="form-input"
                                            [(ngModel)]="profileData.state"
                                            (ngModelChange)="onFieldChange()">
                                            <option value="">Select State</option>
                                            <option *ngFor="let state of stateOptions" [value]="state">{{ state }}</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>ZIP Code</label>
                                        <input
                                            type="text"
                                            class="form-input"
                                            [(ngModel)]="profileData.zip"
                                            (ngModelChange)="onFieldChange()"
                                            placeholder="12345">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Family Members -->
                    <div class="profile-card">
                        <div class="card-header">
                            <span class="header-icon"><i class="bx bx-group"></i></span>
                            <h3>Family Members</h3>
                        </div>
                        <div class="card-body">
                            <p class="section-description">Add family members included in your membership (spouse, children, etc.)</p>

                            <div class="family-members-list" *ngIf="profileData.familyMembers.length > 0">
                                <div class="family-member-card" *ngFor="let member of profileData.familyMembers; let i = index">
                                    <div class="member-header">
                                        <span class="member-number">Family Member {{ i + 1 }}</span>
                                        <button type="button" class="btn-remove-member" (click)="removeFamilyMember(i)">
                                            <i class="bx bx-trash"></i>
                                        </button>
                                    </div>
                                    <div class="member-body">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label>First Name</label>
                                                    <input
                                                        type="text"
                                                        class="form-input"
                                                        [(ngModel)]="member.firstName"
                                                        (ngModelChange)="onFieldChange()"
                                                        placeholder="First name">
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label>Last Name</label>
                                                    <input
                                                        type="text"
                                                        class="form-input"
                                                        [(ngModel)]="member.lastName"
                                                        (ngModelChange)="onFieldChange()"
                                                        placeholder="Last name">
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label>Relationship</label>
                                                    <select
                                                        class="form-input"
                                                        [(ngModel)]="member.relationship"
                                                        (ngModelChange)="onFieldChange()">
                                                        <option value="">Select...</option>
                                                        <option *ngFor="let rel of relationshipOptions" [value]="rel">{{ rel }}</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label>Date of Birth</label>
                                                    <input
                                                        type="date"
                                                        class="form-input"
                                                        [(ngModel)]="member.dateOfBirth"
                                                        (ngModelChange)="onFieldChange()">
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label>Email</label>
                                                    <input
                                                        type="email"
                                                        class="form-input"
                                                        [(ngModel)]="member.email"
                                                        (ngModelChange)="onFieldChange()"
                                                        placeholder="email@example.com">
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label>Phone</label>
                                                    <input
                                                        type="tel"
                                                        class="form-input"
                                                        [(ngModel)]="member.phone"
                                                        (ngModelChange)="onFieldChange()"
                                                        placeholder="(555) 123-4567">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button type="button" class="btn-add-member" (click)="addFamilyMember()">
                                <i class="bx bx-plus"></i> Add Family Member
                            </button>
                        </div>
                    </div>

                    <!-- Communication Preferences -->
                    <div class="profile-card">
                        <div class="card-header">
                            <span class="header-icon"><i class="bx bx-bell"></i></span>
                            <h3>Communication Preferences</h3>
                        </div>
                        <div class="card-body">
                            <div class="preference-item">
                                <label class="checkbox-label">
                                    <input
                                        type="checkbox"
                                        [(ngModel)]="profileData.emailNotifications"
                                        (ngModelChange)="onFieldChange()">
                                    <span class="checkmark"></span>
                                    <span class="label-text">
                                        <strong>Email Notifications</strong>
                                        <small>Receive updates about your membership, events, and policy information</small>
                                    </span>
                                </label>
                            </div>
                            <div class="preference-item">
                                <label class="checkbox-label">
                                    <input
                                        type="checkbox"
                                        [(ngModel)]="profileData.smsNotifications"
                                        (ngModelChange)="onFieldChange()">
                                    <span class="checkmark"></span>
                                    <span class="label-text">
                                        <strong>SMS Notifications</strong>
                                        <small>Receive text messages for important alerts and reminders</small>
                                    </span>
                                </label>
                            </div>
                            <div class="preference-item">
                                <label class="checkbox-label">
                                    <input
                                        type="checkbox"
                                        [(ngModel)]="profileData.newsletterSubscribed"
                                        (ngModelChange)="onFieldChange()">
                                    <span class="checkmark"></span>
                                    <span class="label-text">
                                        <strong>Newsletter Subscription</strong>
                                        <small>Receive our monthly newsletter with community news and events</small>
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar Column -->
                <div class="col-lg-4">
                    <!-- Membership Info Card -->
                    <div class="sidebar-card membership-card">
                        <div class="card-header">
                            <span class="header-icon"><i class="bx bx-id-card"></i></span>
                            <h3>Membership Info</h3>
                        </div>
                        <div class="card-body">
                            <div class="info-item">
                                <span class="info-label">Member ID</span>
                                <span class="info-value">{{ profileData.memberId }}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Member Since</span>
                                <span class="info-value">{{ formatMemberSince() }}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Council</span>
                                <span class="info-value">{{ profileData.council }} #{{ profileData.councilNumber }}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Status</span>
                                <span class="status-badge active">Active</span>
                            </div>
                        </div>
                    </div>

                    <!-- Account Security Card -->
                    <div class="sidebar-card">
                        <div class="card-header">
                            <span class="header-icon"><i class="bx bx-lock-alt"></i></span>
                            <h3>Account Security</h3>
                        </div>
                        <div class="card-body">
                            <a href="javascript:void(0)" class="security-link">
                                <i class="bx bx-key"></i>
                                <span>Change Password</span>
                                <i class="bx bx-chevron-right"></i>
                            </a>
                            <a href="javascript:void(0)" class="security-link">
                                <i class="bx bx-shield-quarter"></i>
                                <span>Two-Factor Authentication</span>
                                <i class="bx bx-chevron-right"></i>
                            </a>
                            <a href="javascript:void(0)" class="security-link">
                                <i class="bx bx-history"></i>
                                <span>Login History</span>
                                <i class="bx bx-chevron-right"></i>
                            </a>
                        </div>
                    </div>

                    <!-- Need Help Card -->
                    <div class="sidebar-card help-card">
                        <div class="help-icon">
                            <i class="bx bx-help-circle"></i>
                        </div>
                        <h4>Need Help?</h4>
                        <p>Contact our membership services team for assistance with your profile or account.</p>
                        <a href="mailto:membership@mypfsa.org" class="help-link">
                            <i class="bx bx-envelope"></i> membership&#64;mypfsa.org
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Save Bar (Fixed) -->
        <div class="save-bar" *ngIf="hasChanges">
            <div class="save-bar-content">
                <span class="unsaved-text">
                    <i class="bx bx-error-circle"></i> You have unsaved changes
                </span>
                <div class="save-bar-actions">
                    <button class="btn-cancel" (click)="cancelChanges()">Cancel</button>
                    <button class="btn-save" (click)="saveProfile()" [disabled]="saving || !isFormValid()">
                        <i class="bx" [ngClass]="saving ? 'bx-loader-alt bx-spin' : 'bx-save'"></i>
                        {{ saving ? 'Saving...' : 'Save Changes' }}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<app-footer></app-footer>
